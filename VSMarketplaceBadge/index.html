<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@csshooo" />
    <meta name="twitter:title" content="VSMarketplaceBadge" />
    <meta name="twitter:description" content="Version, installs and rating badge for Visual Studio Marketplace." />
    <meta name="twitter:image" content="https://vsmarketplacebadge.apphb.com/image/vsmb.png" />
    <title>VSMarketplaceBadge</title>
    <meta name="description" content="Version, installs and rating badge for Visual Studio Marketplace." />
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-corner/dist/fork-corner.min.css">
    <link 
        rel="stylesheet"
        href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"
        integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7"
        crossorigin="anonymous">
    <style type="text/css">
        .jumbotron {
            padding: 30px;
            display: table;
            width: 100%;
        }

        .badge-url {
            height: 38px;
        }

        span {
            font-size: 16px;
        }
    </style>
</head>

<body>
    <!-- Fork Corner -->
    <a 
        href="https://github.com/cssho/VSMarketplaceBadge"
        target="_blank" 
        id="fork-corner"
        class="fork-corner fc-pos-tr fc-animate-default fc-theme-github">
    </a>
    <div class="container">
        <div class="header clearfix">
            <h1>VSMarketplaceBadge</h1>
            <h2>Version, installs and rating badge for Visual Studio Marketplace.</h2>
        </div>
        <div class="jumbotron">
            <div class="col-lg-12" style="margin-bottom:10px;">
                <p>Item Name(e.g. ms-vscode.csharp):</p>
                <div class="col-lg-5">
                    <input type="text" id="item" list="items" class="form-control" />
                    <datalist id="items"></datalist>
                </div>
                <div class="col-lg-2">
                    <button class="btn btn-default" id="get_badge">Find</button>
                </div>
            </div>
            <div class="col-lg-12">
                <span>Version : </span><img id="badge_version" />
                <div id="bv_url" class="well well-sm badge-url">&nbsp;</div>
            </div>
            <div class="col-lg-12">
                <span>Version(Short) : </span><img id="badge_version_short" />
                <div id="bvs_url" class="well well-sm badge-url"></div>
            </div>
            <div class="col-lg-12">
                <span>Installs : </span><img id="badge_installs" />
                <div id="bi_url" class="well well-sm badge-url"></div>
            </div>
            <div class="col-lg-12">
                <span>Installs(Short) : </span><img id="badge_installs_short" />
                <div id="bis_url" class="well well-sm badge-url"></div>
            </div>
            <div class="col-lg-12">
                <span>Downloads : </span><img id="badge_downloads" />
                <div id="bd_url" class="well well-sm badge-url"></div>
            </div>
            <div class="col-lg-12">
                <span>Downloads(Short) : </span><img id="badge_downloads_short" />
                <div id="bds_url" class="well well-sm badge-url"></div>
            </div>
            <div class="col-lg-12">
                <span>Rating : </span><img id="badge_rating" />
                <div id="br_url" class="well well-sm badge-url"></div>
            </div>
            <div class="col-lg-12">
                <span>Rating(Short) : </span><img id="badge_rating_short" />
                <div id="brs_url" class="well well-sm badge-url"></div>
            </div>
            <div class="col-lg-12">
                <span>Rating(Star) : </span><img id="badge_rating_star" />
                <div id="brst_url" class="well well-sm badge-url"></div>
            </div>
            <div class="col-lg-12">
                <span>TrendingDaily : </span><img id="badge_trending_daily" />
                <div id="btd_url" class="well well-sm badge-url"></div>
            </div>
            <div class="col-lg-12">
                <span>TrendingWeekly : </span><img id="badge_trending_weekly" />
                <div id="btw_url" class="well well-sm badge-url"></div>
            </div>
            <div class="col-lg-12">
                <span>TrendingMonthly : </span><img id="badge_trending_monthly" />
                <div id="btm_url" class="well well-sm badge-url"></div>
            </div>
            <div class="col-lg-10">
                <p>Badge created by <a href="http://shields.io/">Shields.io</a></p>
            </div>
            <div class="col-lg-2">
                <a href="https://twitter.com/share" class="twitter-share-button" data-via="csshooo" data-size="large" data-related="code" data-hashtags="VSMarketplaceBadge">Tweet</a>
                <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
            </div>
        </div>
    </div>
    <script src="//code.jquery.com/jquery-2.2.2.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/fork-corner/dist/fork-corner.min.js" defer></script>
    <script type="text/javascript">
        $(function () {
            $("#item").keyup(function (e) {
                if (e.which === 190) {
                    var item = $('#item').val();
                    var data = {
                        assetTypes: [
                            'Microsoft.VisualStudio.Services.Icons.Default'
                        ],
                        filters: [
                            {
                                criteria: [
                                    {
                                        filterType: 10,
                                        value: `publisher:\"${escape(item.substr(0, item.length - 1))}\"`
                                    }
                                ],
                                "pageSize": 100,
                                "pageNumber": 1
                            }
                        ]
                    }
                    $.ajax({
                        url: 'https://marketplace.visualstudio.com/_apis/public/gallery/extensionquery',
                        method: 'POST',
                        contentType: 'application/json',
                        data: JSON.stringify(data),
                        dataType: "json",
                        headers: {
                            'Accept': 'application/json;api-version=3.0-preview.1'
                        }
                    }).done(function (json) {
                        if (json.results.length === 1 && json.results[0].extensions.length >= 1) {
                            $('#items').empty();
                            $.each(json.results[0].extensions, function () {
                                $('#items').append($('<option>').val($('#item').val() + this.extensionName));
                            });
                        }

                    });
                }
            });
            $('#get_badge').on('click', function (e) {
                getBadge();
            });
            $('#item').keypress(function (e) {
                if (e.which == 13) {
                    $('#get_badge').trigger('click');
                }
            });
        });
        function getBadge() {
            var item = $('#item').val();
            var vurl = convertAbsUrl('/version/' + item + '.svg');
            var iurl = convertAbsUrl('/installs/' + item + '.svg');
            var rurl = convertAbsUrl('/rating/' + item + '.svg');
            var vsurl = convertAbsUrl('/version-short/' + item + '.svg');
            var isurl = convertAbsUrl('/installs-short/' + item + '.svg');
            var rsurl = convertAbsUrl('/rating-short/' + item + '.svg');
            var rsturl = convertAbsUrl('/rating-star/' + item + '.svg');
            var tdurl = convertAbsUrl('/trending-daily/' + item + '.svg');
            var twurl = convertAbsUrl('/trending-weekly/' + item + '.svg');
            var tmurl = convertAbsUrl('/trending-monthly/' + item + '.svg');

            var durl = convertAbsUrl('/downloads/' + item + '.svg');
            var dsurl = convertAbsUrl('/downloads-short/' + item + '.svg');
            $('#badge_version').attr("src", vurl);
            $('#bv_url').text(vurl);
            $('#badge_installs').attr("src", iurl);
            $('#bi_url').text(iurl);
            $('#badge_rating').attr("src", rurl);
            $('#br_url').text(rurl);
            $('#badge_version_short').attr("src", vsurl);
            $('#bvs_url').text(vsurl);
            $('#badge_rating_short').attr("src", rsurl);
            $('#brs_url').text(rsurl);
            $('#badge_rating_star').attr("src", rsturl);
            $('#brst_url').text(rsturl);
            $('#badge_installs_short').attr("src", isurl);
            $('#bis_url').text(isurl);
            $('#badge_trending_daily').attr("src", tdurl);
            $('#btd_url').text(tdurl);
            $('#badge_trending_weekly').attr("src", twurl);
            $('#btw_url').text(twurl);
            $('#badge_trending_monthly').attr("src", tmurl);
            $('#btm_url').text(tmurl);
            $('#badge_downloads').attr("src", durl);
            $('#bd_url').text(durl);
            $('#badge_downloads_short').attr("src", dsurl);
            $('#bds_url').text(dsurl);
        }
        function convertAbsUrl(src) {
            return $("<a>").attr("href", src).get(0).href;
        }

    </script>
</body>

</html>
